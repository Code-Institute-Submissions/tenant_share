{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}

{% block content %}
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="card col-11 col-md-9 mt-3 max-card">
                <h3 class="md-heading m-1">Search Maintenance Requests</h3>
                <hr class="m-1">
                <div class="col-12">
                    <form id="maint-search-form" class="row mb-2" method="get">
                        <div class="col-12">{{ maint_filter.form.title__icontains|as_crispy_field }}</div>
                        <div class="col-6 col-sm-3">{{ maint_filter.form.priority|as_crispy_field }}</div>
                        <div class="col-6 col-sm-3">{{ maint_filter.form.status|as_crispy_field }}</div>
                        <div class="col-6 col-sm-3">{{ maint_filter.form.author|as_crispy_field }}</div>
                        <div class="col-6 col-sm-3">{{ maint_filter.form.paid_by|as_crispy_field }}</div>                                         
                        <div class="col-12">
                            <div class="row justify-content-between">
                                <div class="col-6 mt-3">
                                    <button class="btn btn-md btn-info" type="submit">Search</button>
                                    {% if total > maint_filter.qs.count  %}
                                    <a href="{% url 'maint-list' %}" class="btn btn-md btn-outline-info mt-2 mt-sm-0">Clear Filters</a>
                                    {% endif %}
                                </div>
                                <div class="col-5 col-sm-3 mt-3">
                                        {{ maint_filter.form.ordering|as_crispy_field }}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- if user does/does not have a rental -->
        {% if requests %}
            <div class="row justify-content-center mt-2">
                <div class="col-10 col-md-9 text-right">
                    <a href="{% url 'maint-create' %}" class="btn btn-sm btn-success">+ Add maintenance issue</a>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="card max-card col-11 col-md-9 mt-3 mb-3">
                    <div class="row justify-content-center">
                        {% include 'maintenance/_maint_list_item.html' %}
                    </div>
                    <div class="pagination">
                        <span class="step-links">
                            {% if requests.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ contacts.previous_page_number }}">previous</a>
                            {% endif %}
                        
                            <span class="current">
                                Page {{ requests.number }} of {{ requests.paginator.num_pages }}.
                            </span>
                        
                            {% if requests.has_next %}
                            <a href="?page={{ requests.next_page_number }}">next</a>
                            <a href="?page={{ requests.paginator.num_pages }}">last &raquo;</a>
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        {% else %}
        <div class="row justify-content-center">
            <div class="card col-10 col-md-9 jumbotron mt-3 mb-3">
                <div class="col-12 text-center">
                    <h1 class="lg-heading">You need a rental property to use this section</h1>
                    <p class="d-block md-text">You don't have a rental property associated with your account.</p>
                    <p class="d-block md-text">Either add a property or speak to your landlord.</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>



{% endblock %}